# Copyright 2011 Rendaw, under the FreeBSD license (See included LICENSE.txt)
#
# Make sure tup.config exists for config variables. It should be created by configure.sh

# Organizing flags and such
REVISION = 5
COMPILEFLAGS = -std=c++0x -pedantic -Wno-long-long -Wall -I@(ENVTEMP_PROJECTROOT) -D REVISION=$(REVISION)
LINKFLAGS = 

COMPILEDEBUGFLAGS = -ggdb -D DEBUG -O0 -fno-inline -fno-omit-frame-pointer -D DATALOCATION=\"data\" -D SETTINGSLOCATION=\"inscribist.conf\"
COMPILERELEASEFLAGS = -D NDEBUG -O3 -D DATALOCATION=\"/usr/local/share/inscribist\"
LINKDEBUGFLAGS = -ggdb
LINKRELEASEFLAGS =

INCLUDECONTENTS = @(ENV_CFLAGS) @(GEN_GTKCFLAGS)
LINKCONTENTS = @(ENV_LDFLAGS) @(GEN_GTKLDFLAGS) -llua5.2 -lbz2

BINEXTENSION = 

# Applying settings (as possible) to flags
ifeq (@(ENV_PLATFORM),windows)
	COMPILEFLAGS += -DWINDOWS
	BINEXTENSION = .exe
endif
ifeq (@(ENV_PLATFORM),linux)
	COMPILEFLAGS += -DLINUX 
endif 

# Compilation/link macros with flags included
!compiledebug = |> g++ $(COMPILEFLAGS) $(COMPILEDEBUGFLAGS) $(INCLUDECONTENTS) -c %f -o %o |> %o
!compilerelease = |> g++ $(COMPILEFLAGS) $(COMPILERELEASEFLAGS) $(INCLUDECONTENTS) -c %f -o %o |> %o
LINKDEBUG = g++ $(LINKFLAGS) $(LINKDEBUGFLAGS)
LINKRELEASE = g++ $(LINKFLAGS) $(LINKRELEASEFLAGS)

# Compilation
GENERAL_SOURCES = \
	../ren-general/color.cxx \
	../ren-general/range.cxx \
	../ren-general/region.cxx \
	../ren-general/rotation.cxx \
	../ren-general/vector.cxx
APPLICATION_SOURCES = \
	../ren-application/lightsettings.cxx \
	../ren-application/stringtable.cxx
SCRIPT_SOURCES = \
	../ren-script/script.cxx
INSCRIBIST_SOURCES = \
	../main.cxx \
	../settingsdialog.cxx \
	../settings.cxx \
	../cursorstate.cxx \
	../image.cxx \
	../gtkwrapper.cxx

SOURCES = $(GENERAL_SOURCES) $(SCRIPT_SOURCES) $(APPLICATION_SOURCES) $(INSCRIBIST_SOURCES)

ifeq (@(DEBUG),true)
	: foreach $(SOURCES) |> !compiledebug |> %B.debug.o {debugobjects}
	: {debugobjects} |> $(LINKDEBUG) -o %o %f $(LINKCONTENTS) |> inscribist.debug$(BINEXTENSION)
endif
ifeq (@(RELEASE),true)
	: foreach $(SOURCES) |> !compilerelease |> %B.o {releaseobjects}
	: {releaseobjects} |> $(LINKRELEASE) -o %o %f $(LINKCONTENTS) |> inscribist$(BINEXTENSION)
endif

